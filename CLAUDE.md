我的数据库三张表
create table public.optimization_history (
  id bigint generated by default as identity not null,
  user_id uuid null,
  original_prompt text not null,
  optimized_prompt text not null,
  mode text not null,
  created_at timestamp with time zone not null default now(),
  session_id text null,
  user_type text null default 'authenticated'::text,
  constraint optimization_history_pkey primary key (id),
  constraint optimization_history_user_id_fkey foreign KEY (user_id) references auth.users (id) on delete CASCADE,
  constraint optimization_history_user_type_check check (
    (
      user_type = any (array['authenticated'::text, 'anonymous'::text])
    )
  ),
  constraint user_identification_check check (
    (
      (
        (user_type = 'authenticated'::text)
        and (user_id is not null)
        and (session_id is null)
      )
      or (
        (user_type = 'anonymous'::text)
        and (user_id is null)
        and (session_id is not null)
      )
    )
  )
) TABLESPACE pg_default;

create index IF not exists optimization_history_user_id_idx on public.optimization_history using btree (user_id) TABLESPACE pg_default;

create index IF not exists optimization_history_session_id_idx on public.optimization_history using btree (session_id) TABLESPACE pg_default;

create index IF not exists optimization_history_user_type_idx on public.optimization_history using btree (user_type) TABLESPACE pg_default;

create table public.profiles (
  id uuid not null,
  username text null,
  avatar_url text null,
  updated_at timestamp with time zone not null default now(),
  constraint profiles_pkey primary key (id),
  constraint profiles_username_key unique (username),
  constraint profiles_id_fkey foreign KEY (id) references auth.users (id) on delete CASCADE,
  constraint username_length check ((char_length(username) >= 3))
) TABLESPACE pg_default;

create trigger on_profiles_updated BEFORE
update on profiles for EACH row
execute FUNCTION handle_updated_at ();

create table public.subscriptions (
  id uuid not null,
  status public.subscription_status not null,
  plan_id text null,
  current_period_start timestamp with time zone null,
  current_period_end timestamp with time zone null,
  stripe_customer_id text null,
  stripe_subscription_id text null,
  constraint subscriptions_pkey primary key (id),
  constraint subscriptions_stripe_customer_id_key unique (stripe_customer_id),
  constraint subscriptions_stripe_subscription_id_key unique (stripe_subscription_id),
  constraint subscriptions_id_fkey foreign KEY (id) references auth.users (id) on delete CASCADE
) TABLESPACE pg_default;